<?xml version="1.0" encoding="utf-8" ?>

<mdscript name="WeaponFind" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="C:/x4 extract/libraries/md.xsd">
    <cues>
        <cue name="WeaponFindStart">
            <conditions>
                <event_cue_signalled cue="md.Setup.GameStart" />
            </conditions>
            <delay exact="15s" />
            <actions>
                <remove_help all="true" />
                <set_value name="$Count1" exact="0" />
                <set_value name="$Count2" exact="0" />
                <set_value name="$Count3" exact="0" />
                <set_value name="$Count4" exact="0" />
                <set_value name="$Macroname1" exact="macro.turret_arg_m_dumbfire_02_mk1" />
                <set_value name="$Macroname2" exact="macro.turret_par_m_guided_02_mk1" />
                <set_value name="$Macroname3" exact="macro.turret_tel_m_guided_02_mk1" />
                <set_value name="$Macroname4" exact="macro.turret_tel_m_dumbfire_02_mk1" />
                <find_ship name="$Ships" space="player.galaxy" multiple="true" />
                <do_for_each in="$Ships" name="$Ship">
                    <!-- recursive="true" might need -->
                    <find_object_component name="$Weapons" object="$Ship"  multiple="true">
                        <match_any>
                            <match class="[class.turret, class.weapon]" negate="true" />
                            <match integrated="true" />
                            <match integrated="false" />
                        </match_any>
                    </find_object_component>
                    <do_for_each in="$Weapons" name="$Weapon">
                        <do_if value="$Weapon.macro == $Macroname1">
                             <set_value name="$Count1" exact="1" operation="add" />
                        </do_if>
                        <do_if value="$Weapon.macro == $Macroname2">
                             <set_value name="$Count2" exact="1" operation="add" />
                        </do_if>
                        <do_if value="$Weapon.macro == $Macroname3">
                             <set_value name="$Count3" exact="1" operation="add" />
                        </do_if>
                    </do_for_each>
                </do_for_each>
                <show_help custom="'$Macroname1:' + $Count1 + '$Macroname2: ' + $Count2 + '$Macroname3: ' + $Count3 + '$Macroname4: ' + $Count4"  duration="60"/>
                </actions>
        </cue>
    </cues>
</mdscript>